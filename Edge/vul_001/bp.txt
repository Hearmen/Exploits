crash

08d749e0 63192983 EDGEHTML!CCookieDataList<CSVGTransform,CSVGMatrixData *,CSVGTransform>::Clear+0x9
08d74a10 6316dd89 EDGEHTML!CSVGTransformList::FromString+0x14
08d74a30 631704ca EDGEHTML!CSVGHelpers::SetAttributeStringAndList<CCookieDataList<CSVGTransform,CSVGMatrixData *,CSVGTransform>,CSVGTransformList>+0x84
08d74a40 627b9601 EDGEHTML!CSVGElement::SetTransformHelper+0x1a
08d74aa4 628be29b EDGEHTML!PROPERTYDESC::HandleStringProperty+0x691
08d74acc 62978604 EDGEHTML!PROPERTYDESC::CallHandler+0x6f


free 
16eaefd8 
    address 16eaefd8 found in
    _DPH_HEAP_ROOT @ a01000
    in free-ed allocation (  DPH_HEAP_BLOCK:         VirtAddr         VirtSize)
                                   16e90d00:         16eae000             2000
    680e9cd2 verifier!AVrfDebugPageHeapFree+0x000000c2
    77c52e80 ntdll!RtlDebugFreeHeap+0x0000003c
    77c0e142 ntdll!RtlpFreeHeap+0x0006c992
    77c05d8c ntdll!RtlpFreeHeapInternal+0x0000027e
    77ba0a8c ntdll!RtlFreeHeap+0x0000002c
    627bdbed EDGEHTML!MemoryProtection::HeapFree+0x0000004d
    631704ca EDGEHTML!CSVGElement::SetTransformHelper+0x0000001a
    627b9601 EDGEHTML!PROPERTYDESC::HandleStringProperty+0x00000691
    628be29b EDGEHTML!PROPERTYDESC::CallHandler+0x0000006f
    62978604 EDGEHTML!CElement::SetAttributeFromPropDesc+0x000000af
    629765b8 EDGEHTML!CElement::ie9_setAttributeNSInternal+0x00000348
    62976256 EDGEHTML!CElement::setAttributeNS_Helper+0x0000006a
    629761c6 EDGEHTML!CElement::Var_setAttribute+0x000000eb
    629760c2 EDGEHTML!CFastDOM::CElement::Trampoline_setAttribute+0x00000042
    5ef662ce chakra!Js::JavascriptExternalFunction::ExternalFunctionThunk+0x0000019e

00c870bf+EDGEHTML clear -- >> not free
mov     ecx,esi
6316dda2 e8f48be4ff      call    EDGEHTML!CCookieDataList<CSVGTransform,CSVGMatrixData *,CSVGTransform>::`scalar deleting destructor' (62fb699b)



alloc

    6eb49abc verifier!AVrfDebugPageHeapAllocate+0x0000023c
    77c52671 ntdll!RtlDebugAllocateHeap+0x0000003c
    77c0f12f ntdll!RtlpAllocateHeap+0x0006ae2f
    77ba2950 ntdll!RtlpAllocateHeapInternal+0x00000270
    77ba26b8 ntdll!RtlAllocateHeap+0x00000028
    627bdc24 EDGEHTML!MemoryProtection::HeapAlloc<0>+0x00000024
    631704ca EDGEHTML!CSVGElement::SetTransformHelper+0x0000001a
    627b9601 EDGEHTML!PROPERTYDESC::HandleStringProperty+0x00000691
    628be29b EDGEHTML!PROPERTYDESC::CallHandler+0x0000006f
    62978604 EDGEHTML!CElement::SetAttributeFromPropDesc+0x000000af
    629765b8 EDGEHTML!CElement::ie9_setAttributeNSInternal+0x00000348
    62976256 EDGEHTML!CElement::setAttributeNS_Helper+0x0000006a
    629761c6 EDGEHTML!CElement::Var_setAttribute+0x000000eb
    629760c2 EDGEHTML!CFastDOM::CElement::Trampoline_setAttribute+0x00000042
    5ef662ce chakra!Js::JavascriptExternalFunction::ExternalFunctionThunk+0x0000019e
    5ef66493 chakra!Js::JavascriptFunction::CallFunction<1>+0x00000093
    5eed7455 chakra!Js::InterpreterStackFrame::OP_CallCommon<Js::OpLayoutDynamicProfile<Js::OpLayoutT_CallI<Js::LayoutSizePolicy<0> > > >+0x00000085
    5eeda2a7 chakra!Js::InterpreterStackFrame::OP_ProfiledReturnTypeCallI<Js::OpLayoutT_CallI<Js::LayoutSizePolicy<0> > >+0x00000037
    5eede165 chakra!Js::InterpreterStackFrame::ProcessProfiled+0x00000ae5
    5eedb9f7 chakra!Js::InterpreterStackFrame::Process+0x000000c7
    5eedad26 chakra!Js::InterpreterStackFrame::OP_TryCatch+0x00000046
    5eede856 chakra!Js::InterpreterStackFrame::ProcessProfiled+0x000011d6
    5eedb9f7 chakra!Js::InterpreterStackFrame::Process+0x000000c7
    5ee0753d chakra!Js::InterpreterStackFrame::InterpreterHelper+0x000002dd
    5ee0724a chakra!Js::InterpreterStackFrame::InterpreterThunk+0x0000003a

00e404ca +EDGEHTML

6316dd3b 8b0dbc4e3c63    mov     ecx,dword ptr [EDGEHTML!g_hProcessHeap (633c4ebc)]
6316dd41 6a24            push    24h
6316dd43 5a              pop     edx
6316dd44 e8b7fe64ff      call    EDGEHTML!MemoryProtection::HeapAlloc<0> (627bdc00)

bp 00e3dd49+EDGEHTML ".printf \"Obj alloc at: %x\\n\",@eax;g;"
bp 00e3dd32+EDGEHTML ".printf \"Judge: %x\\n\",@esi;g;"
bp 00e3dd75+EDGEHTML ".printf \"After PutAAPointer: %x\\n\",@esi;dd @esi L10;g;" 
bp 00e3dd84+EDGEHTML ".printf \"Before FromString: %x\\n\",@esi;dd @esi L10;g;" 


CSVGHelpers::SetAttributeStringAndPointer<CDOMStringDataList,CSVGStringList>   ?
CSVGHelpers::SetAttributeStringAndList<CDOMStringDataList,CSVGStringList>    !!!!

CSVGHelpers::SetAttributeStringAndPointer<CRectF,CSVGRect>  !!!!!

CSVGHelpers::SetAttributeStringAndList
	GetAAPoint !!!!!!!
	FromString 

UAF

问题函数是CSVGHelpers::SetAttributeStringAndList
函数用于设置SVGElement对象属性
函数大体逻辑为首先从SVGElement中获取transform结构体，如果没有这个结构体就新建一个。然后通过这个结构体进行SVG对象的transform操作。新建结构体操作会触发DOMAttrModify
当transform被设置为“none”，使用FromString处理之后，对象释放。

样本构造递归调用setAttribute("transform","none")处理同一个对象。使得上一层函数中申请的transform结构体在下层递归中被释放
当上层函数操作transform结构体时会操作到一个已经释放的地址

漏洞触发流程大体如下：
CSVGHelpers::SetAttributeStringAndList
	GetAAPoint=NULL
	 new transformA
	  FireDOMAttrModify ==>> CSVGHelpers::SetAttributeStringAndList
					GetAAPoint=transformA
					FromString 
					Free transformA
	FromString 
	Free transformA   !!!!!CRASH!!!!!!
					
					
	
bp 00c870bf+edgehtml ".printf \"esi: %x\\n\",@esi;dd @esi;.if (poi(@esi)=41414102 ){}.else{g;}"
	


