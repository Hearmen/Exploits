#漏洞名(edgehtml+00c870c8)

##样本
####MD5 hash: 685ebbf8bf38237461c0465dffacb433

##环境信息
###1. 系统信息

    Windows 10 Pro x86

###2. 软件信息

	Microsoft Edge 20.10240.16384.0

###3. 漏洞模块信息

	edgehtml.dll v11.0.10240.16384
    {34F39692-89F1-4E42-8C8C-060419697A35}



##漏洞信息
###1. 漏洞类型

	UAF

###2. 可利用性

	可利用

###3. 漏洞详细分析

####3.1 重要信息

- **UAF对象**：          transform结构体
- **对象大小**：         0x24
- **对象所属堆区**：      g_hProcessHeap
- **Create位置**：       `EDGEHTML!CSVGHelpers::SetAttributeStringAndList` + 0x0000003f
![Create](Create.png)
- **Free位置**：         `EDGEHTML!CSVGHelpers::SetAttributeStringAndList` + 0x0000009d
![Free](Free.png)
- **Reuse位置**：        `EDGEHTML!CSVGHelpers::SetAttributeStringAndList` + 0x0000007f
![Reuse](Reuse.png)

####3.2 详细分析

	问题函数是  SVGHelpers::SetAttributeStringAndList
    
    函数用于设置SVGElement对象transform属性
    函数大体逻辑为首先从SVGElement中获取transform结构体，如果没有这个结构体就新建一个。然后通过这个结构体进行SVG对象的transform操作。
    将tranform结构与SVGElement绑定时会触发DOMAttrModify事件
    使用FromString处理transform,当解析transform参数失败时函数返回，transform对象释放。

    样本构造递归调用setAttribute("transform","none")处理同一个对象。使得上一层函数中申请的transform结构体在下层递归中被释放
    当上层函数操作transform结构体时会操作到一个已经释放的地址

    漏洞触发流程大体如下：
    CSVGHelpers::SetAttributeStringAndList
        GetAAPoint=NULL
	    new transformA
	    PutAAPointer
            FireDOMAttrModify ==>> CSVGHelpers::SetAttributeStringAndList
					               GetAAPoint=transformA
					               FromString 
					               Free transformA
	    FromString     **!!!!!USE!!!!!!**
	    Free transformA   


####3.3 修补方案
    在PutAAPoint之后再次GetAAPoint获取并检测



